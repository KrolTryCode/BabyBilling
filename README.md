# BabyBilling

В данном проекте реализованы 3 микросервиса:
1. __CDR__ -- отвечает за генерацию CDR файлов, данные для генерации берет из таблицы локальной БД H2 -- subscribers(localhost:8081/subscribers)
После чего все сгенерированные звонки записываются в соседнюю таблицу этой БД -- transactions(localhost:8081/transactions)
В данном сервисе в файле конфигурации можно отключить генератор файлов --> будут использоваться файлы из папки ./CDR, находящейся в корне проекта

Из папки CDR файлы построчно отправляются через Kafka в BRT

2. __BRT__ -- отвечает за авторизацию пользователей, имеет БД PostgreSQL с двумя таблицами:
     --_subscribers_, содержащей информацию об обслуживаемых абонентах(номер, тариф и баланс)
     --_tariffs_, содержащей информацию о тарифах
   Приходящие записи проходят авторизацию, дополняются данными о тарифе и отправляются в HRS
   От HRS приходят данные о списании у абонентов, BRT обновляет баланс на их основании

   Также в данном сервисе реализован API для пополнения баланса абонентами, смены тарифа и добавления абонентов для менеджеров
   Менеджеры могут зайти с логином admin и паролем admin, абоненты просто указав номер телефона

3. __HRS__ -- отвечает за расчет стоимости и отправку данных BRT. Держит в кэше данные об абонентах и тарифах, которые отправляются при поднятии сервиса BRT и при изменении данных.
На основании типа, длительности звонка и его адресата возвращает сразу запись о списании денег при классическом тарифе, и хранит в кэше данные о потраченных минутах, на основании которых в конце месяца происходит расчет для помесячных тарифов.

## Структура приложения и схема взаимодействия сервисов

![structure](https://github.com/KrolTryCode/BabyBilling/assets/89705642/20f109b2-801e-4513-b3b0-cd8550ed6c79)

## Ссылка на Swagger UI

Доступ к документации API через Swagger UI:

[Swagger UI](http://localhost:8080/swagger-ui/index.html#)
Данные для авторизации: менеджер -- _admin/admin_; абонент -- _номер_телефона_

## Запуск сервисов в ручном режиме
Для запуска в ручном режиме нужно поочередно запустить:
  1. PosgresSQL с созданной базой данных __brt__, логином __user__ и паролем __123__
  2. Zookeeper
  3. Kafka
  далее через DockerFile
  4. HRS
  5. BRT
  6. CDR

а также изменить файлы конфигурации application.properties(kafka, postgres -->localhost)
